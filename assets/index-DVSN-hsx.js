(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))r(n);new MutationObserver(n=>{for(const c of n)if(c.type==="childList")for(const a of c.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&r(a)}).observe(document,{childList:!0,subtree:!0});function o(n){const c={};return n.integrity&&(c.integrity=n.integrity),n.referrerPolicy&&(c.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?c.credentials="include":n.crossOrigin==="anonymous"?c.credentials="omit":c.credentials="same-origin",c}function r(n){if(n.ep)return;n.ep=!0;const c=o(n);fetch(n.href,c)}})();const Q=()=>document.getElementById("card-template").content.querySelector(".card").cloneNode(!0),F=(e,{userId:t,onPreviewPicture:o,onLikeIcon:r,onDeleteCard:n})=>{const c=Q(),a=c.querySelector(".card__like-button"),P=c.querySelector(".card__control-button_type_delete"),v=c.querySelector(".card__image"),b=c.querySelector(".card__like-count");v.src=e.link,v.alt=e.name,c.querySelector(".card__title").textContent=e.name;const T=e.likes.some(G=>G._id===t);return T&&a.classList.add("card__like-button_is-active"),b&&(b.textContent=e.likes?e.likes.length:0),r&&a.addEventListener("click",()=>r(e._id,T,a,b)),e.owner._id!==t&&(P.style.display="none"),n&&P.addEventListener("click",()=>n(c,e._id)),o&&v.addEventListener("click",()=>o({name:e.name,link:e.link})),c},N=e=>{if(e.key==="Escape"){const t=document.querySelector(".popup_is-opened");i(t)}},m=e=>{e.classList.add("popup_is-opened"),document.addEventListener("keyup",N)},i=e=>{e.classList.remove("popup_is-opened"),document.removeEventListener("keyup",N)},X=e=>{e.querySelector(".popup__close").addEventListener("click",()=>{i(e)}),e.addEventListener("mousedown",o=>{o.target.classList.contains("popup")&&i(e)})},h=(e,t,o,r)=>{const n=e.querySelector(`#${t.id}-error`);t.classList.add(r.inputErrorClass),n.textContent=o,n.classList.add(r.errorClass)},O=(e,t,o)=>{const r=e.querySelector(`#${t.id}-error`);t.classList.remove(o.inputErrorClass),r.textContent="",r.classList.remove(o.errorClass)},Y=(e,t,o)=>{if(t.validity.valid)O(e,t,o);else if(t.validity.valueMissing)h(e,t,"Это поле обязательно для заполнения",o);else if(t.validity.patternMismatch){const r=t.getAttribute("data-error-message");h(e,t,r,o)}else t.type==="url"&&t.validity.typeMismatch?h(e,t,"Введите корректный URL",o):h(e,t,t.validationMessage,o)},Z=e=>e.some(t=>!t.validity.valid),W=(e,t)=>{e.classList.add(t.inactiveButtonClass),e.disabled=!0},ee=(e,t)=>{e.classList.remove(t.inactiveButtonClass),e.disabled=!1},A=(e,t,o)=>{Z(e)?W(t,o):ee(t,o)},te=(e,t)=>{const o=Array.from(e.querySelectorAll(t.inputSelector)),r=e.querySelector(t.submitButtonSelector);A(o,r,t),o.forEach(n=>{n.addEventListener("input",()=>{Y(e,n,t),A(o,r,t)})})},q=(e,t)=>{const o=Array.from(e.querySelectorAll(t.inputSelector)),r=e.querySelector(t.submitButtonSelector);o.forEach(n=>{O(e,n,t)}),W(r,t)},oe=e=>{Array.from(document.querySelectorAll(e.formSelector)).forEach(o=>{te(o,e),o.addEventListener("submit",r=>{r.preventDefault()})})},s={baseUrl:"https://mesto.nomoreparties.co/v1/apf-cohort-202",headers:{authorization:"0bd7766c-ae8b-4135-b599-888c3b09f0b3","Content-Type":"application/json"}},u=e=>e.ok?e.json():Promise.reject(`Ошибка: ${e.status}`),re=()=>fetch(`${s.baseUrl}/users/me`,{headers:s.headers}).then(u),V=()=>fetch(`${s.baseUrl}/cards`,{headers:s.headers}).then(u),ne=({name:e,about:t})=>fetch(`${s.baseUrl}/users/me`,{method:"PATCH",headers:s.headers,body:JSON.stringify({name:e,about:t})}).then(u),ce=e=>fetch(`${s.baseUrl}/users/me/avatar`,{method:"PATCH",headers:s.headers,body:JSON.stringify({avatar:e})}).then(u),se=({name:e,link:t})=>fetch(`${s.baseUrl}/cards`,{method:"POST",headers:s.headers,body:JSON.stringify({name:e,link:t})}).then(u),ae=e=>fetch(`${s.baseUrl}/cards/${e}`,{method:"DELETE",headers:s.headers}).then(u),ie=(e,t)=>fetch(`${s.baseUrl}/cards/likes/${e}`,{method:t?"DELETE":"PUT",headers:s.headers}).then(u),H=document.querySelector(".places__list"),x=document.querySelector(".popup_type_edit"),d=x.querySelector(".popup__form"),j=d.querySelector(".popup__input_type_name"),J=d.querySelector(".popup__input_type_description"),k=document.querySelector(".popup_type_new-card"),l=k.querySelector(".popup__form"),le=l.querySelector(".popup__input_type_card-name"),ue=l.querySelector(".popup__input_type_url"),I=document.querySelector(".popup_type_image"),D=I.querySelector(".popup__image"),pe=I.querySelector(".popup__caption"),de=document.querySelector(".profile__edit-button"),_e=document.querySelector(".profile__add-button"),E=document.querySelector(".profile__title"),B=document.querySelector(".profile__description"),M=document.querySelector(".profile__image"),w=document.querySelector(".popup_type_edit-avatar"),_=w.querySelector(".popup__form"),me=_.querySelector(".popup__input"),g=document.querySelector(".popup_type_remove-card"),C=g.querySelector(".popup__form"),y=document.querySelector(".popup_type_info"),fe=y.querySelector(".popup__title"),p=y.querySelector(".popup__info"),ye=y.querySelector(".popup__text"),U=y.querySelector(".popup__list"),he=document.querySelector(".logo");let L;const S={formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_disabled",inputErrorClass:"popup__input_type_error",errorClass:"popup__error_visible"},R=({name:e,link:t})=>{D.src=t,D.alt=e,pe.textContent=e,m(I)},Se=e=>{if(e.preventDefault(),d.checkValidity()){const t=d.querySelector(".popup__button"),o=t.textContent;t.textContent="Сохранение...",ne({name:j.value,about:J.value}).then(r=>{E.textContent=r.name,B.textContent=r.about,i(x)}).catch(r=>{console.log(r)}).finally(()=>{t.textContent=o})}},ve=e=>{if(e.preventDefault(),_.checkValidity()){const t=_.querySelector(".popup__button"),o=t.textContent;t.textContent="Сохранение...",ce(me.value).then(r=>{M.style.backgroundImage=`url(${r.avatar})`,i(w)}).catch(r=>{console.log(r)}).finally(()=>{t.textContent=o})}},be=e=>{if(e.preventDefault(),l.checkValidity()){const t=l.querySelector(".popup__button"),o=t.textContent;t.textContent="Создание...",se({name:le.value,link:ue.value}).then(r=>{H.prepend(F(r,{userId:L,onPreviewPicture:R,onLikeIcon:K,onDeleteCard:z})),i(k)}).catch(r=>{console.log(r)}).finally(()=>{t.textContent=o})}},z=(e,t)=>{m(g);const o=r=>{r.preventDefault();const n=C.querySelector(".popup__button"),c=n.textContent;n.textContent="Удаление...",ae(t).then(()=>{e.remove(),i(g),C.removeEventListener("submit",o)}).catch(a=>{console.log("Ошибка при удалении карточки:",a)}).finally(()=>{n.textContent=c})};C.addEventListener("submit",o)},K=(e,t,o,r)=>{ie(e,t).then(n=>{o.classList.toggle("card__like-button_is-active"),r.textContent=n.likes.length}).catch(n=>{console.log("Ошибка при лайке:",n)})},$=e=>e.toLocaleDateString("ru-RU",{year:"numeric",month:"long",day:"numeric"}),f=(e,t)=>{const r=document.getElementById("popup-info-definition-template").content.cloneNode(!0);return r.querySelector(".popup__info-term").textContent=e,r.querySelector(".popup__info-description").textContent=t,r},Ce=e=>{const o=document.getElementById("popup-info-user-preview-template").content.cloneNode(!0),r=o.querySelector(".popup__list-item_type_badge");return r.textContent=e.name,o},ge=()=>{fe.textContent="Статистика пользователей",p.innerHTML="",ye.textContent="Все пользователи",U.innerHTML="",V().then(e=>{const t=[];let o=0;e.forEach(r=>{t.some(c=>c._id===r.owner._id)||t.push(r.owner),r.likes.forEach(c=>{t.some(a=>a._id===c._id)||t.push(c)});const n=e.filter(c=>c.owner._id===r.owner._id).length;n>o&&(o=n)}),p.append(f("Всего карточек:",e.length.toString())),p.append(f("Первая создана:",$(new Date(e[e.length-1].createdAt)))),p.append(f("Последняя создана:",$(new Date(e[0].createdAt)))),p.append(f("Всего пользователей:",t.length.toString())),p.append(f("Максимум карточек от одного:",o.toString())),t.length>0&&t.forEach(r=>{U.append(Ce(r))}),m(y)}).catch(e=>{console.log(e)})};d.addEventListener("submit",Se);l.addEventListener("submit",be);_.addEventListener("submit",ve);he.addEventListener("click",ge);de.addEventListener("click",()=>{j.value=E.textContent,J.value=B.textContent,q(d,S),m(x)});M.addEventListener("click",()=>{q(_,S),_.reset(),m(w)});_e.addEventListener("click",()=>{q(l,S),l.reset(),m(k)});const Le=document.querySelectorAll(".popup");Le.forEach(e=>{X(e)});oe(S);Promise.all([V(),re()]).then(([e,t])=>{L=t._id,E.textContent=t.name,B.textContent=t.about,M.style.backgroundImage=`url(${t.avatar})`,e.forEach(o=>H.append(F(o,{userId:L,onPreviewPicture:R,onLikeIcon:K,onDeleteCard:z})))}).catch(e=>{console.log(e)});
